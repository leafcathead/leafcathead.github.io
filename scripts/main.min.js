var rhit=rhit||{};function htmlToElement(e){var t=document.createElement("template");return e=e.trim(),t.innerHTML=e,t.content.firstChild}rhit.FB_COLLECTION_ALLCOURSES="Courses",rhit.FB_KEY_CLASSID="classID",rhit.FB_KEY_COURSETAKING="courseTaking",rhit.FB_KEY_QUARTER="quarterTaking",rhit.FB_KEY_USER="id",rhit.FB_KEY_USERS="users",rhit.FB_KEY_MAJOR="major",rhit.FB_KEY_STARTYEAR="startYear",rhit.mouseDown=!1,rhit.FB_KEY_DEFAULTCSSE="defaultCSSE",rhit.FB_KEY_COURSENAME="courseName",rhit.FB_KEY_COURSENUMBER="courseNumber",rhit.FB_KEY_FULLNAME="fullName",rhit.FB_KEY_CREDITHOURS="creditHours",rhit.FB_KEY_DEPARTMENT="department",rhit.FB_KEY_DESCRIPTION="description",rhit.FB_KEY_PREREQUISTES="prerequisites",rhit.FB_KEY_CUSTOMPREREQUISTES="customPrerequisites",rhit.FB_KEY_COREQUISTES="corequisites",rhit.FB_KEY_TERMAVAILABLE="termAvailable",rhit.FB_KEY_POSTREQUISITES="postrequisites",rhit.FB_KEY_LASTTOUCHED="lastTouched",rhit.FB_KEY_MANDATORY="mandatory",rhit.fullNameArray=[],rhit.fbAuthManager=null,rhit.flowPageController=null,rhit.fbFlowManager=null,rhit.creditHours=new Array(13).fill(0),rhit.currentData=new Map,rhit.classIndex,rhit.Number=0,rhit.LoginPageController=class{constructor(){document.querySelector("#rosefireButton").onclick=(e=>{rhit.fbAuthManager.signIn()})}},rhit.FbAuthManager=class{constructor(){this._user=null,console.log("You have made the auth manager")}beginListening(e){firebase.auth().onAuthStateChanged(t=>{if(this._user=t,e(),t){t.uid}})}signIn(){console.log("Sign in button"),Rosefire.signIn("5753f046-a299-4cc8-a81d-3581c90cd4ea",(e,t)=>{e?console.log("Rosefire error!",e):(console.log("Rosefire success!",t),firebase.auth().signInWithCustomToken(t.token).catch(e=>{const t=e.code,r=e.message;"auth/invalid-custom-token"===t?alert("The token you provided is not valid"):console.error("Custom auth error",t,r)}))})}signOut(){firebase.auth().signOut().then(()=>{console.log("You are now signed out")}).catch(e=>{console.log("Sign out error")})}get isSignedIn(){return!!this._user}get uid(){return this._user.uid}};let theDropzoneSelectors=".quarterColumn",dropzones=document.querySelectorAll(theDropzoneSelectors);const sortable=new Sortable.default(dropzones,{draggable:".classItem",dropzone:".quarterColumn",mirror:{constrainDimensions:!0},delay:{mouse:0,drag:0,touch:100}});function select(e,t){for(var r,s=document.getElementById(e),i=s.options,o=0;r=i[o];o++)if(r.value==t){s.selectedIndex=o;break}}function autocomplete(e,t){var r;function s(e){if(!e)return!1;!function(e){for(var t=0;t<e.length;t++)e[t].classList.remove("autocomplete-active")}(e),r>=e.length&&(r=0),r<0&&(r=e.length-1),e[r].classList.add("autocomplete-active")}function i(t){for(var r=document.getElementsByClassName("autocomplete-items"),s=0;s<r.length;s++)t!=r[s]&&t!=e&&r[s].parentNode.removeChild(r[s])}e.addEventListener("input",function(s){var o,n,a,l=this.value;if(i(),!l)return!1;for(r=-1,(o=document.createElement("DIV")).setAttribute("id",this.id+"autocomplete-list"),o.setAttribute("class","autocomplete-items"),this.parentNode.appendChild(o),a=0;a<t.length;a++){const r=t[a].toUpperCase().indexOf(l.toUpperCase());-1!==r&&((n=document.createElement("DIV")).innerHTML="",n.innerHTML+=t[a].substr(0,r),n.innerHTML+="<strong>"+t[a].substr(r,l.length)+"</strong>",n.innerHTML+=t[a].substr(l.length+r),n.innerHTML+="<input type='hidden' value='"+t[a]+"'>",n.addEventListener("click",function(t){e.value=this.getElementsByTagName("input")[0].value,i()}),o.appendChild(n))}}),e.addEventListener("keydown",function(e){var t=document.getElementById(this.id+"autocomplete-list");t&&(t=t.getElementsByTagName("div")),40==e.keyCode?(r++,s(t)):38==e.keyCode?(r--,s(t)):13==e.keyCode&&(e.preventDefault(),r>-1&&t&&t[r].click())}),document.addEventListener("click",function(e){i(e.target)})}sortable.on("sortable:stop",()=>setTimeout(rhit.flowPageController.updateClassesArray,1)),rhit.FlowPageController=class{constructor(){window.addEventListener("mouseup",e=>{rhit.mouseDown=!1}),rhit.fbFlowManager.beginListening(this.updateClasses.bind(this)),document.querySelector("#addClass").addEventListener("click",e=>{let t=document.querySelector("#inputCourse").value;-1!==t.indexOf("-")?t=t.split(" - ")[0]:"Free Elective"==t?t="FREE":"HSSA Elective"==t?t="HSSA":"Science Elective"==t?t="SCI":"Tech Elective"==t?t="TECH":"CSSE ELECTIVE"==t&&(t="CSSE");const r=document.querySelector("#yearBrowser").value,s=document.querySelector("#quarterBrowser").value;if(document.querySelector("#inputCourse").value="",select("yearBrowser","selectYear"),select("quarterBrowser","selectQuarter"),"selectYear"==r||"selectQuarter"==s)return;let i=parseInt(s)+3*parseInt(r);rhit.fbFlowManager.classData.has(t)&&rhit.fbFlowManager.add(t,i)}),$("#addClassDialog").on("shown.bs.modal",e=>{document.querySelector("#inputCourse").focus()}),$("#developerModal").on("show.bs.modal",e=>{console.log("dialog about to show up"),document.querySelector("#devInput").value=""}),$("#developerModal").on("shown.bs.modal",e=>{document.querySelector("#devInput").focus()}),document.querySelector("#closeButton").addEventListener("click",e=>{$("#courseDescriptionDialog").modal("hide")}),document.querySelector("#deleteButton").addEventListener("click",e=>{rhit.fbFlowManager.classArray.splice(rhit.classIndex,1),$("#courseDescriptionDialog").modal("hide"),rhit.fbFlowManager.updateClass()}),document.querySelector("#menuSignOut").addEventListener("click",e=>{rhit.fbAuthManager.signOut()}),document.querySelector("#submitResetCourses").addEventListener("click",e=>{rhit.fbFlowManager.resetCourses()}),document.querySelector("#submitClearCourses").addEventListener("click",e=>{rhit.fbFlowManager.clearCourses()}),document.querySelector("#enterDevInput").addEventListener("click",e=>{let t=document.querySelector("#devInput").value.toString().split("\n");for(let e of t){const t=e.split(",")[0],r=e.split(",")[1];rhit.fbFlowManager.classData.has(t)&&rhit.fbFlowManager.add(t,r)}})}updateClassesArray(){rhit.fbFlowManager.classArray=[];let e=document.querySelectorAll(".classItem");for(let t of e)t.parentElement.dataset.indexNumber?rhit.fbFlowManager.classArray.push(t.dataset.courseNumber+","+t.parentElement.dataset.indexNumber):t.parentElement.lastChild.remove();rhit.fbFlowManager.updateClass()}updateStuff(){}updateClasses(){rhit.currentData=new Map,rhit.creditHours=new Array(13).fill(0),this.clearQuarters();for(let e=0;e<rhit.fbFlowManager.classArray.length;e++){let t=rhit.fbFlowManager.classArray[e].split(","),r=rhit.fbFlowManager.classData.get(t[0]),s=parseInt(t[1]),i="";0==this.meetsQuarter(s,r.get(rhit.FB_KEY_TERMAVAILABLE))&&(i="*");let o=this.getNumber(s),n=r.get(rhit.FB_KEY_COURSENUMBER),a=r.get(rhit.FB_KEY_CREDITHOURS);const l=htmlToElement(`<div id ="${r.get(rhit.FB_KEY_COURSENUMBER)}" class="classItem"\n            data-course-number="${r.get(rhit.FB_KEY_COURSENUMBER)}" data-mouse-down="false">${n}<br>(${a})${i}\n            </div>`);let u=r.get(rhit.FB_KEY_DEPARTMENT),c=r.get(rhit.FB_KEY_COURSENUMBER);"CSSE"===u?l.style.borderColor="#00b0f0":"MA"===u||"PH"===u||"CHEM"===u||"SCIENCE"===u?l.style.borderColor="#fffb21":"HSSA"===u?l.style.borderColor="#a142ff":"ECE"===u?l.style.borderColor="#47ff9a":"TECH"===u?l.style.borderColor="#6be0ef":"RHIT 100"===c&&(l.style.borderColor="red"),rhit.currentData.has(r.get(rhit.FB_KEY_COURSENUMBER))?(rhit.Number++,rhit.currentData.set(r.get(rhit.FB_KEY_COURSENUMBER)+rhit.Number,r)):rhit.currentData.set(r.get(rhit.FB_KEY_COURSENUMBER),r),l.onmouseover=(e=>{this.meetPrereqs(r)?l.style.backgroundColor="#82EEFD":l.style.backgroundColor="#ff625b",this.highLightPrerequisites(r,!0,"orange"),this.highLightPostrequisites(r,!0,"#03AC13")}),l.onmouseout=(e=>{this.meetPrereqs(r)?(l.style.backgroundColor="white",l.style.color="black"):l.style.backgroundColor="#ff312c",this.highLightPrerequisites(r,!1),this.highLightPostrequisites(r,!1)}),l.onmousedown=(t=>{rhit.mouseDown=!0,console.log("hi"),setTimeout(function(){if(!rhit.mouseDown){console.log("click!"),rhit.classIndex=e,document.getElementById("courseTitle").innerHTML=r.get(rhit.FB_KEY_FULLNAME),document.getElementById("courseDescription").innerHTML=r.get(rhit.FB_KEY_DESCRIPTION),document.getElementById("prereqs").innerHTML=this.getPrerequisites(r);let t=this.getTermOffered(s,r.get(rhit.FB_KEY_TERMAVAILABLE));document.getElementById("termOffered").innerHTML="Terms avaiable:"+t,$("#courseDescriptionDialog").modal("show")}}.bind(this),125)}),document.querySelector(`#${o}`).append(l),rhit.creditHours[s]=rhit.creditHours[s]+r.get(rhit.FB_KEY_CREDITHOURS)}let e=document.getElementsByClassName("classItem");for(let t of e){let e=rhit.fbFlowManager.classData.get(t.id);this.meetPrereqs(e)||(t.style.backgroundColor="#ff312c")}this.meetGraduationRequireents(),this.updateCreditHours();document.querySelectorAll(".classItem")}meetsQuarter(e,t){return e%3==1?t[0]?1:0:e%3==2?t[1]?1:0:t[2]?1:0}meetGraduationRequireents(){let e="",t=!0;console.log("MEET GRAD REQ");var r=new Map(rhit.currentData);let s=rhit.fbFlowManager.graduation;for(let i=0;i<s.data().mandatory.length;i++){let o=s.data().mandatory[i].split(","),n=!1;for(let e=0;e<o.length;e++)if(r.has(o[e])){r.delete(o[e]),n=!0;break}n||(t=!1,e+=`<p style = 'color:red'>Please Add: ${s.data().mandatory[i]}</p>`,console.log("Needs one of these classes:"+s.data().mandatory[i]))}let i=s.data().DEPARTMENT[0].split(","),o=parseInt(i[1]),n=s.data().HSSA,a=s.data().SCIENCE,l=s.data().TECH,u=s.data().FREE,c=!1;for(let[e,t]of r){let e=t.get(rhit.FB_KEY_DEPARTMENT);if(console.log("MAP THROUGH"+t),e===i[0]&&0!=o?o--:"HSSA"===e&&0!=n?n--:"PH"!=e&&"CHEM"!=e&&"BIO"!=e&&"SCIENCE"!=e||0==a?"HSSA"!==e&&"ELECTIVE"!==e&&0!=l?l--:0!=u&&u--:a--,0==o&&0==n&&0==a&&0==l&&0==u){console.log("TRUE"),c=!0;break}}console.log("CORE"+o+" HSSA"+n+" SCI"+a+" TECH"+l+" FREE"+u),c||(t=!1),1==t?document.querySelector("#gradText").innerHTML="<p style = 'color:green'font-wight:bold;>Graduation Requirement Met!</p>":(e="<p style = 'color:red'><strong>DOES NOT MEET GRADUATION REQUIREMENT</strong></p>"+e,0!=o&&(e+=`<p style = 'color:red'>Insert ${o} more ${i[0]} Classes</p>`),0!=n&&(e+=`<p style = 'color:red'>Insert ${n} more HSSA Classes</p>`),0!=a&&(e+=`<p style = 'color:red'>Insert ${a} more Science Classes</p>`),0!=l&&(e+=`<p style = 'color:red'>Insert ${l} more Tech Classes</p>`),0!=u&&(e+=`<p style = 'color:red'>Insert ${u} more Classes(to meet free elective)</p>`),document.querySelector("#gradText").innerHTML=e)}getPrerequisites(e){let t="Prerequisites: ",r=e.get(rhit.FB_KEY_PREREQUISTES);if(0==r.length)return"Prerequisites: None";for(let s=0;s<r.length;s++){let i=parseInt(document.getElementById(e.get(rhit.FB_KEY_COURSENUMBER)).parentElement.dataset.indexNumber),o=r[s].split(","),n="",a=!1;for(let e=0;e<o.length;e++){if(rhit.currentData.has(o[e])){parseInt(document.getElementById(o[e]).parentElement.dataset.indexNumber)<i&&(a=!0)}n=n+o[e]+" or "}n=n.substr(0,n.length-3),a||(n="<span style = 'color:red'>"+n+"</span>"),t+=n,t+=" and "}return t=t.substr(0,t.length-4)}getTermOffered(e,t){let r=" ",s=!1;return t[0]&&(r+=" F",s=!0),t[1]&&(r+=" W",s=!0),t[2]&&(r+=" S",s=!0),s?this.meetsQuarter(e,t)||(r+=" <br><span style='color: red'>Warning: Course typically not offered this quarter</span>"):r+="<span style='color: #CC5801'>Varies (check manually)</span>",r}meetPrereqs(e){let t=parseInt(document.getElementById(e.get(rhit.FB_KEY_COURSENUMBER)).parentElement.dataset.indexNumber),r=e.get(rhit.FB_KEY_PREREQUISTES);for(let e=0;e<r.length;e++){let s=!1,i=r[e].split(",");for(let e=0;e<i.length;e++)if(rhit.currentData.has(i[e])){parseInt(document.getElementById(i[e]).parentElement.dataset.indexNumber)<t&&(s=!0)}if(!s)return!1}return!0}clearQuarters(){let e=document.getElementsByClassName("quarterColumn");for(let t of e)t.innerHTML=""}highLightPrerequisites(e,t,r){let s=e.get(rhit.FB_KEY_PREREQUISTES);for(let e=0;e<s.length;e++){let i=s[e].split(",");for(let e=0;e<i.length;e++)null!==document.getElementById(i[e])&&(!0===t?document.getElementById(i[e]).style.backgroundColor=r:this.meetPrereqs(rhit.fbFlowManager.classData.get(i[e]))?document.getElementById(i[e]).style.backgroundColor="white":document.getElementById(i[e]).style.backgroundColor="red",this.highLightPrerequisites(rhit.fbFlowManager.classData.get(i[e]),t,"#FED8B1"))}}highLightPostrequisites(e,t,r){let s=e.get(rhit.FB_KEY_POSTREQUISITES);for(let e=0;e<s.length;e++)null!==document.getElementById(s[e])&&(!0===t?document.getElementById(s[e]).style.backgroundColor=r:this.meetPrereqs(rhit.fbFlowManager.classData.get(s[e]))?document.getElementById(s[e]).style.backgroundColor="white":document.getElementById(s[e]).style.backgroundColor="red",this.highLightPostrequisites(rhit.fbFlowManager.classData.get(s[e]),t,"lightgreen"))}updateCreditHours(){let e=0;e+=rhit.creditHours[1],document.querySelector("#creditOne").innerHTML=rhit.creditHours[1]+`(${e})`,document.querySelector("#creditOne").dataset.indexNumber=rhit.creditHours[1],e+=rhit.creditHours[2],document.querySelector("#creditTwo").innerHTML=rhit.creditHours[2]+`(${e})`,document.querySelector("#creditTwo").dataset.indexNumber=rhit.creditHours[2],e+=rhit.creditHours[3],document.querySelector("#creditThree").innerHTML=rhit.creditHours[3]+`(${e})`,document.querySelector("#creditThree").dataset.indexNumber=rhit.creditHours[3],e+=rhit.creditHours[4],document.querySelector("#creditFour").innerHTML=rhit.creditHours[4]+`(${e})`,document.querySelector("#creditFour").dataset.indexNumber=rhit.creditHours[4],e+=rhit.creditHours[5],document.querySelector("#creditFive").innerHTML=rhit.creditHours[5]+`(${e})`,document.querySelector("#creditFive").dataset.indexNumber=rhit.creditHours[5],e+=rhit.creditHours[6],document.querySelector("#creditSix").innerHTML=rhit.creditHours[6]+`(${e})`,document.querySelector("#creditSix").dataset.indexNumber=rhit.creditHours[6],e+=rhit.creditHours[7],document.querySelector("#creditSeven").innerHTML=rhit.creditHours[7]+`(${e})`,document.querySelector("#creditSeven").dataset.indexNumber=rhit.creditHours[7],e+=rhit.creditHours[8],document.querySelector("#creditEight").innerHTML=rhit.creditHours[8]+`(${e})`,document.querySelector("#creditEight").dataset.indexNumber=rhit.creditHours[8],e+=rhit.creditHours[9],document.querySelector("#creditNine").innerHTML=rhit.creditHours[9]+`(${e})`,document.querySelector("#creditNine").dataset.indexNumber=rhit.creditHours[9],e+=rhit.creditHours[10],document.querySelector("#creditTen").innerHTML=rhit.creditHours[10]+`(${e})`,document.querySelector("#creditTen").dataset.indexNumber=rhit.creditHours[10],e+=rhit.creditHours[11],document.querySelector("#creditEleven").innerHTML=rhit.creditHours[11]+`(${e})`,document.querySelector("#creditEleven").dataset.indexNumber=rhit.creditHours[11],e+=rhit.creditHours[12],document.querySelector("#creditTwelve").innerHTML=rhit.creditHours[12]+`(${e})`,document.querySelector("#creditTwelve").dataset.indexNumber=rhit.creditHours[12],this.checkForOverload()}checkForOverload(){let e=document.querySelectorAll(".credits");for(var t=0;t<e.length;t++)e[t].dataset.indexNumber>24?e[t].style.color="red":e[t].dataset.indexNumber>18?e[t].style.color="#fc6a08":e[t].style.color="black"}getNumber(e){return 1===e?"one":2===e?"two":3===e?"three":4===e?"four":5===e?"five":6===e?"six":7===e?"seven":8===e?"eight":9===e?"nine":10===e?"ten":11===e?"eleven":12===e?"twelve":void 0}_createCard(e){}getClassData(e){}},rhit.FbFlowManager=class{constructor(e){this._uid=e,this._userCollection=firebase.firestore().collection(rhit.FB_KEY_USERS),this._CSSECOLLECTION=this._userCollection.doc(rhit.FB_KEY_DEFAULTCSSE),this._userRef=this._userCollection.doc(e),this.gradReq=firebase.firestore().collection("Graduation").doc("ComputerScience"),this.classArray=[],this._documentSnapshots=[],this.graduation=null,this.ref=firebase.firestore().collection("Courses"),this._unsubscribe=null,this._unsubscribe2=null,this._unsubscribe3=null,this.classData=new Map,this.postData=new Map,this._unsubscribe2=this.ref.onSnapshot(e=>{this._documentSnapshots=e.docs}),this._unsubscribe3=this.gradReq.onSnapshot(e=>{e.exists?(this.graduation=e,console.log("Document data:",e.data()),console.log(this.graduation.data().mandatory)):console.log("No such document!")})}resetCourses(){this._CSSECOLLECTION.get().then(e=>{e.exists&&(this.classArray=e.data().courseTaking,this._userRef.set({[rhit.FB_KEY_COURSETAKING]:this.classArray,[rhit.FB_KEY_MAJOR]:"CSSE",[rhit.FB_KEY_STARTYEAR]:2020})),rhit.flowPageController.updateClasses()})}clearCourses(){this._userRef.set({[rhit.FB_KEY_COURSETAKING]:[],[rhit.FB_KEY_MAJOR]:"CSSE",[rhit.FB_KEY_STARTYEAR]:2020}),rhit.flowPageController.updateClasses()}beginListening(e){this._unsubscribe=this._userRef.onSnapshot(t=>{t.exists?(this.classArray=t.data().courseTaking,e()):this._CSSECOLLECTION=this._CSSECOLLECTION.onSnapshot(t=>{t.exists&&(this.classArray=t.data().courseTaking,this._userRef.set({[rhit.FB_KEY_COURSETAKING]:this.classArray,[rhit.FB_KEY_MAJOR]:"CSSE",[rhit.FB_KEY_STARTYEAR]:2020}),e())})})}makePostReqs(e){let t=this.classData.get(e).get(rhit.FB_KEY_PREREQUISTES);for(let r=0;r<t.length;r++){let s=t[r].split(",");for(let t=0;t<s.length;t++){let r=[];this.classData.has(s[t])&&(this.postData.has(s[t])?((r=this.postData.get(s[t])).push(e),this.postData.delete(s[t]),this.postData.set(s[t],r)):(r.push(e),this.postData.set(s[t],r)))}}}setMap(){for(let e=0;e<this._documentSnapshots.length;e++)this.classData.set(this._documentSnapshots[e].get(rhit.FB_KEY_COURSENUMBER),this._documentSnapshots[e]),rhit.fullNameArray.push(this._documentSnapshots[e].get(rhit.FB_KEY_FULLNAME))}add(e,t){this.classArray.push(e+","+t),this._userRef.update({[rhit.FB_KEY_COURSETAKING]:this.classArray})}updateClass(){this._userRef.update({[rhit.FB_KEY_COURSETAKING]:this.classArray})}get length(){return this._documentSnapshots.length}insertClass(){}addClass(){}removeClass(){}meetPrereqs(){}meetCoreqs(){}getCreditHours(){}showCourseDescription(){}highlightOnHover(){}},rhit.Class=class{constructor(e,t,r,s,i,o,n,a,l,u){this.courseNumber=t,this.courseName=e,this.fullName=t+" - "+e,this.creditHours=r,this.department=s,this.description=i,this.prerequisites=o,this.customPrerequisites=n,this.corequisites=a,this.termAvailable=l,this.quarterTaking=u}},rhit.initializePage=function(){document.querySelector("#loginPage")?new rhit.LoginPageController:document.querySelector("#flowPage")&&(rhit.fbFlowManager=new rhit.FbFlowManager(this.fbAuthManager.uid),rhit.flowPageController=new rhit.FlowPageController,autocomplete(document.getElementById("inputCourse"),rhit.fullNameArray),setTimeout(function(){rhit.fbFlowManager.setMap(),rhit.flowPageController.updateClasses()},1e3))},rhit.checkForRedirects=function(){document.querySelector("#loginPage")&&rhit.fbAuthManager.isSignedIn&&(window.location.href="/flowchart.html"),document.querySelector("#loginPage")||rhit.fbAuthManager.isSignedIn||(window.location.href="/")},rhit.main=function(){rhit.fbAuthManager=new rhit.FbAuthManager,rhit.fbAuthManager.beginListening(()=>{rhit.checkForRedirects(),rhit.initializePage()}),rhit.startFirebaseUI()},rhit.startFirebaseUI=function(){var e={signInSuccessUrl:"/",signInOptions:[firebase.auth.GoogleAuthProvider.PROVIDER_ID,firebase.auth.EmailAuthProvider.PROVIDER_ID,firebaseui.auth.AnonymousAuthProvider.PROVIDER_ID]};new firebaseui.auth.AuthUI(firebase.auth()).start("#firebaseui-auth-container",e)},rhit.main();